(function(){async function f(e){const t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error("Manifest fetch failed: "+t.status);return await t.json()}async function m(e){const t=await fetch(e,{cache:"no-store"}),n=await t.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(a)).map(o=>o.toString(16).padStart(2,"0")).join("")}function p(){const e=document.createElement("div");return Object.assign(e.style,{position:"absolute",top:"8px",right:"8px",padding:"6px 8px",fontSize:"12px",borderRadius:"6px",background:"rgba(0,0,0,.75)",color:"#fff",cursor:"pointer",userSelect:"none"}),e.textContent="CR",e.title="Content Credentials",e}function y(){const e=document.createElement("div");Object.assign(e.style,{position:"fixed",inset:"0",background:"rgba(0,0,0,.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:"9999"});const t=document.createElement("div");Object.assign(t.style,{background:"#fff",borderRadius:"12px",maxWidth:"620px",width:"92%",padding:"16px",boxShadow:"0 10px 30px rgba(0,0,0,.2)",fontFamily:"system-ui,Segoe UI,Roboto,Arial,sans-serif"});const n=document.createElement("h3");n.textContent="Content Credentials",n.style.marginTop="0";const a=document.createElement("pre");Object.assign(a.style,{whiteSpace:"pre-wrap",fontSize:"12px",lineHeight:"1.4",background:"#0f172a",color:"#e5e7eb",padding:"12px",borderRadius:"8px",overflow:"auto"});const o=document.createElement("button");return o.textContent="Close",o.style.marginTop="12px",o.onclick=()=>document.body.removeChild(e),t.appendChild(n),t.appendChild(a),t.appendChild(o),e.appendChild(t),{overlay:e,pre:a}}async function h(e){const t=e.getAttribute("data-manifest-url");if(!t)return;const n=document.createElement("div");n.style.position="relative",e.parentNode.insertBefore(n,e),n.appendChild(e);const a=p();n.appendChild(a),a.addEventListener("click",async()=>{const o=y();document.body.appendChild(o.overlay);try{const r=await f(t),s=r.source_sha256||r.asset&&r.asset.sha256;let c=null,i=null;try{const d=await m(e.getAttribute("src"));c={expected:s,actual:d,pass:d===s}}catch(l){i="Hashing failed: "+l.message}o.pre.textContent=JSON.stringify({summary:{creator:r.creator,created_at:r.created_at,tool:r.tool,filename:r.asset&&r.asset.filename||r.source_file},verify:c,raw:r,error:i},null,2)}catch(r){o.pre.textContent="Error: "+r.message}})}function u(){document.querySelectorAll("img[data-manifest-url]").forEach(h)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",u):u(),window.ProofLensVerify={attach:h};})();
